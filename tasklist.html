<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>DashTask</title>

  <!-- Bootstrap core CSS-->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom fonts for this template-->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">

  <!-- Page level plugin CSS-->
  <link href="vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">

  <!-- <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.18/datatables.min.css"/> -->


  <!-- Custom styles for this template-->
  <link href="css/sb-admin.css" rel="stylesheet">
  <link href="css/dashtask.css" rel="stylesheet">

</head>

<body id="page-top">

  <nav class="navbar navbar-expand navbar-dark bg-orange static-top">

    <a class="mr-1" href="index.html"><img src="./assets/images/ICON.png" class="sm"><img src="./assets/images/TASK.png"
      class="lg"></a>

      <!-- Navbar Search -->
      <form class="d-none d-md-inline-block form-inline ml-auto mr-0 mr-md-3 my-2 my-md-0">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Digite o nome do usuário..." aria-label="Search"
          aria-describedby="basic-addon2">
          <div class="input-group-append">
            <button class="btn btn-task-alt btn-task-primary" type="button">
              <i class="fas fa-search"></i>
            </button>
          </div>
        </div>
      </form>

      <!-- Navbar -->
      <ul class="navbar-nav ml-auto ml-md-0">
        <li class="nav-item dropdown no-arrow">
          <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown"
          aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-user-circle fa-fw"></i>
        </a>
        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
          <a class="dropdown-item" href="#">Perfil</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">Sair</a>
        </div>
      </li>
    </ul>

  </nav>

  <div id="wrapper">

    <!-- Sidebar -->
    <ul class="sidebar navbar-nav bg-orange">
      <img src="./assets/images/ICON_TASK.png" class="col-centered logo">
      <li class="nav-item active">
        <div class="">
        </div>
        <a class="nav-link" href="index.html">
          <i class="fas fa-fw fa-tachometer-alt"></i>
          <span>Painel de Controle</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="charts.html">
          <i class="fas fa-plus-circle"></i>
          <span>Nova Task</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="charts.html">
            <i class="fas fa-fw fa-user"></i>
            <span>Ver Funcionário</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="charts.html">
              <i class="fas fa-tasks"></i>
              <span>Ver Tasks</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="charts.html">
                <i class="fas fa-fw fa-chart-area"></i>
                <span>Dados</span></a>
              </li>
            </ul>

            <div id="content-wrapper">

              <div class="container-fluid">

                <!-- Breadcrumbs-->
                <ol class="breadcrumb">
                  <li class="breadcrumb-item">
                    <a href="index.html">Painel de Controle</a>
                  </li>
                  <li class="breadcrumb-item active">Visão Geral</li>
                </ol>
                <div class="row">
                  <div class="card col-md-12">
                    <div class="card-body">
                      <div class="d-md-inline-block">
                        <h1> Lista de Tasks </h1>
                      </div>
<!--                       <div class="col-md-4 float-right" >
                        <form class="form-inline">
                          <div class="form-group mx-sm-3 mb-2">
                            <label for="input_search" class="sr-only">Pesquisar</label>
                            <input type="text" class="form-control" id="input_search" placeholder="Pesquisar">
                          </div>
                          <button type="submit" class="btn btn-primary mb-2">Buscar</button>
                        </form>
                      </div> -->
                      <table class="table table-striped table-condensed table-datatable" id="tabela_tasks">
                        <thead>
                          <tr>
                            <th scope="col">Data</th>
                            <th scope="col">Descrição</th>
                            <th scope="col">Departamento</th>
                            <th scope="col">Prioridade</th>
                            <th scope="col">Encarregado</th>
                            <th></th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td>13/10/2018</td>
                            <td>Lâmpada quebrada</td>
                            <td>Manutenção Elétrica</td>
                            <td>Alta</td>
                            <td>Darlan Nakamura</td>
                            <td>
                             <div class="btn-group">
                              <button type="button" class="btn btn-sm btn-primary reset_multistep btn_img_task" data-toggle="modal" data-target="#modal_imagem">
                                <div class="d-none d-sm-block">
                                  Imagem
                                </div>
                                <div class="d-block d-sm-none">
                                  <i class="fas fa-edit fa-fw"></i>
                                </div>
                              </button>
                              <button type="button" class="btn btn-sm btn-secondary reset_multistep btn_data_task btn-attr-ordem_servico_pk" data-toggle="modal" data-target="#modal_dados">
                                <div class="d-none d-sm-block">
                                  Editar
                                </div>
                                <div class="d-block d-sm-none">
                                  <i class="fas fa-edit fa-fw"></i>
                                </div>
                              </button>
                              <button type="button" class="btn btn-sm btn-danger reset_multistep btn_delete_task" data-toggle="modal" data-target="#modal_delete">
                                <div class="d-none d-sm-block">
                                  Excluir
                                </div>
                                <div class="d-block d-sm-none">
                                  <i class="fas fa-times fa-fw"></i>
                                </div>
                              </button>
                            </div>


                          </td>


                        </tr>
  <!--                 <tr>
                    <th scope="row">2</th>
                    <td>Jacob</td>
                    <td>Thornton</td>
                    <td>@fat</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>Larry</td>
                    <td>the Bird</td>
                    <td>@twitter</td> -->
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="card col-md-12">
          <div id="map">
          </div>
        </div>

        <!-- Sticky Footer -->
        <footer class="sticky-footer">
          <div class="container my-auto">
            <div class="copyright text-center my-auto">
              <span>by Poukas $olutions</span>
            </div>
          </div>
        </footer>
      </div>
      <!-- /.content-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
      <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Deseja sair?</h5>
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">Selecione "Sair" caso queira encerrar a sessão.</div>
        <div class="modal-footer">
          <button class="btn btn-task-alt btn-task-secondary" type="button" data-dismiss="modal">Cancelar (Voltar
          para o Painel)</button>
          <a class="btn btn-task-alt btn-task-primary" href="login.html">Sair</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap core JavaScript-->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Core plugin JavaScript-->
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Page level plugin JavaScript-->
  <script src="vendor/datatables/jquery.dataTables.js"></script>
  <script src="https://cdn.datatables.net/v/dt/dt-1.10.18/datatables.min.js"></script>
  <script src="vendor/datatables/dataTables.bootstrap4.js"></script>
  <script src="vendor/datatables/dataTables.bootstrap4.js"></script>
  <script src="js/dashboard/utils.js"></script>


  <!-- Custom scripts for all pages-->
  <script src="js/sb-admin.min.js"></script>

  <!-- Demo scripts for this page-->
  <script src="js/demo/datatables-demo.js"></script>
  <script src="js/demo/chart-area-demo.js"></script>

  <script>

    var main_marker;
    var map, heatmap;

    $(document).ready(function(){

      var url = 'http://192.168.0.76:5000/api/task?access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjViYzFmODE5NzM1MWVkNGM4NjhhOWY5YiIsImlhdCI6MTUzOTQzOTQ1Mn0.fEbV4eUdUnGbwdGRRKBe2uk87WFgKhNGYvUPDuZ1iHw';

      $.get(url).done(function (response) {
        if (response.code == 200){
          console.log(response);
          writeTable(response.tasks);
          setTasksOnMap(response.tasks);

        }else{
          alert('Falhou filha da puta!');
        }
      // update_table();
      // $('#d_servico').modal('hide');
    });

    });


    function getFormattedDate(date) {
      var year = date.getFullYear();

      var month = (1 + date.getMonth()).toString();
      month = month.length > 1 ? month : '0' + month;

      var day = date.getDate().toString();
      day = day.length > 1 ? day : '0' + day;

      var hour = date.getHours().toString();
      var minutes = date.getMinutes().toString();

      return month + '/' + day + '/' + year +" " + hour + ':' + minutes;
    }

    writeTable = (tasks) =>{

      for(var i = 0; i < tasks.length; i++){
        var date = new Date(tasks[i].created_at);
        var date_formatted = getFormattedDate(date);
        var priority, department;

        switch(tasks[i].priority){
          case 0:
          department = "Manutenção Elétrica";
          priority = "Baixa";
          break;
          case 1:
          department = "Camararia";
          priority = "Média";
          break;
          case 2:
          department = "Manutenção Mecânica";
          priority = "Alta";
          break;
          case 3:
          department = "Limpeza";
          priority = "Emergencial";
          break;
          default:
          department = "Não definido";
          priority = "Não definida";
          break;
        }

        table.row.add([
          date_formatted,
          tasks[i].description,
          department,
          priority,
          'Darlan Nakamura',
          '<div class="btn-group">' +  '<button type="button" class="btn btn-sm btn-primary reset_multistep btn_img_task' + 
          '" data-toggle="modal" value="<'+ i +'>" data-target="#modal_imagem">' +
          '<div class="d-none d-sm-block">' +'Foto </div> <div class="d-block d-sm-none"> <i class="fas fa-edit fa-fw">' +
          '</i></div></button><button type="button" class="btn btn-sm btn-secondary reset_multistep btn_data_task' + 
          'btn-attr-ordem_servico_pk" data-toggle="modal" value="<'+ i +'>" data-target="#modal_dados">' + 
          '<div class="d-none d-sm-block" style="background-color: #ff701a"> Editar </div> <div class="d-block d-sm-none"><i class="fas fa-edit fa-fw">'+ 
          '</i></div></button><button type="button" class="btn btn-sm btn-danger reset_multistep btn_delete_task"'+ 
          'data-toggle="modal" value="<'+ i +'>"data-target="#modal_delete"><div class="d-none d-sm-block">'+'Excluir</div><div' +
          'class="d-block d-sm-none"><i class="fas fa-times fa-fw"></i></div></button></div>'
          ]).draw(false);
      }
    }


    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        zoom: 17,
        center: {lat: -22.121265, lng: -51.383400},
        mapTypeId: 'satellite'
      });


      setTasksOnMap = (tasks) =>{
        for(var i = 0; i < tasks.length; i++){
          console.log(tasks[i].location);
          location_formatted = {
            lat : parseFloat(tasks[i].location.lat),
            lng : parseFloat(tasks[i].location.lng)
          }                
          createMarker(location_formatted, tasks[i].description);
        }
      }

      createMarker = (location, title) => {
        main_marker = new google.maps.Marker({
          position: location,
          map: map,
          title: title
        });
      }
    }

    function toggleHeatmap() {
      heatmap.setMap(heatmap.getMap() ? null : map);
    }
  </script>


  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCEjAPCVxGTFlEnJ64vJUIGgPDwPMLzcHk&libraries=visualization&callback=initMap"></script>

</body>

</html>

